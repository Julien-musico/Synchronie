{% extends "base.html" %}

{% block title %}Dashboard - Synchronie{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
{% endblock %}

{% block content %}
<div class="dash-hero gradient-hero rounded-4 p-4 p-md-5 mb-4">
    <div class="row g-3 justify-content-center mb-2">
        <div class="col-12 col-sm-6 col-lg-3">
            <div class="dashboard-stat-card">
                <i class="bi bi-people"></i>
                <div>
                    <div>Patients actifs</div>
                    <div class="fs-5">{{ stats.patients_actifs or 0 }}</div>
                </div>
            </div>
        </div>
        <div class="col-12 col-sm-6 col-lg-3">
            <div class="dashboard-stat-card">
                <i class="bi bi-file-music"></i>
                <div>
                    <div>Séances ce mois</div>
                    <div class="fs-5">{{ stats.seances_ce_mois or 0 }}</div>
                </div>
            </div>
        </div>
        <div class="col-12 col-sm-6 col-lg-3">
            <div class="dashboard-stat-card">
                <i class="bi bi-robot"></i>
                <div>
                    <div>Total séances</div>
                    <div class="fs-5">{{ stats.total_seances or 0 }}</div>
                </div>
            </div>
        </div>
    </div>
    <div class="mt-4 row g-3 quick-actions">
        <div class="col-12 col-sm-6 col-lg-3">
            <a class="card action-card h-100 border-0 shadow-sm" href="{{ quick_actions.nouveau_patient.url | default('#') }}">
                <div class="card-body d-flex align-items-center gap-3">
                    <div class="action-icon bg-primary-subtle text-primary"><i class="bi bi-person-plus-fill"></i></div>
                    <div><div class="fw-semibold">Nouveau Patient</div><small class="text-white-75">Créer un dossier</small></div>
                </div>
            </a>
        </div>
        <div class="col-12 col-sm-6 col-lg-3">
            <a class="card action-card h-100 border-0 shadow-sm" href="{{ quick_actions.nouvelle_seance.url | default('#') }}">
                <div class="card-body d-flex align-items-center gap-3">
                    <div class="action-icon bg-success-subtle text-success"><i class="bi bi-plus-circle-fill"></i></div>
                    <div><div class="fw-semibold">Nouvelle Séance</div><small class="text-white-75">Planifier / saisir</small></div>
                </div>
            </a>
        </div>
        <div class="col-12 col-sm-6 col-lg-3">
            <a class="card action-card h-100 border-0 shadow-sm" href="{{ quick_actions.nouveau_rapport.url | default('#') }}">
                <div class="card-body d-flex align-items-center gap-3">
                    <div class="action-icon bg-warning-subtle text-warning"><i class="bi bi-file-earmark-text-fill"></i></div>
                    <div><div class="fw-semibold">Nouveau Rapport</div><small class="text-white-75">Synthèse périodique</small></div>
                </div>
            </a>
        </div>
        <div class="col-12 col-sm-6 col-lg-3">
            <a class="card action-card h-100 border-0 shadow-sm" href="{{ quick_actions.agenda.url | default('#') }}">
                <div class="card-body d-flex align-items-center gap-3">
                    <div class="action-icon bg-info-subtle text-info"><i class="bi bi-calendar2-week-fill"></i></div>
                    <div><div class="fw-semibold">Agenda</div><small class="text-white-75">Vue planning</small></div>
                </div>
            </a>
        </div>
    </div>
</div>

<!-- Patients récents -->
<div>
    <div class="d-flex align-items-center justify-content-between mb-3">
        <h5 class="mb-0">Patients récents</h5>
        <a href="{{ recent_patients_url | default(url_for('patients.list_patients')) }}" class="btn btn-sm btn-outline-secondary">Voir tous les patients</a>
    </div>
    {% if recent_patients %}
        <div class="row g-3">
            {% for p in recent_patients %}
            <div class="col-12 col-md-6 col-xl-4">
                <a class="card patient-card h-100 border-0 shadow-sm" href="{{ url_for('patients.view_patient', patient_id=p.id) }}">
                    <div class="card-body">
                        <div class="d-flex align-items-center justify-content-between mb-2">
                            <div class="d-flex align-items-center gap-2">
                                <div class="avatar-pill bg-primary text-white">{{ ((p.prenom or '')[:1]) ~ ((p.nom or '')[:1]) }}</div>
                                <div>
                                    <div class="fw-semibold">{{ p.prenom }} {{ p.nom }}</div>
                                    <small class="text-muted">{{ p.pathologie or '—' }}</small>
                                </div>
                            </div>
                            <span class="badge rounded-pill bg-light text-muted"><i class="bi bi-clock-history me-1"></i>Récent</span>
                        </div>
                        {% if p.objectifs_therapeutiques %}
                        <div class="small text-muted line-clamp-2">{{ p.objectifs_therapeutiques }}</div>
                        {% endif %}
                    </div>
                </a>
            </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="text-muted small">Aucun patient récent pour le moment.</div>
    {% endif %}
</div>
{% endblock %}
